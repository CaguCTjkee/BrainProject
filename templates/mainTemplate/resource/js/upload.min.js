function xhr_complete(b){var a=b.responseText;if(a){a=JSON.parse(a);console.log(a);if(a.error!==""){alert(a.error)}else{if(typeof a.success!=="undefined"){jQuery('input[name="avatar"]').val(a.success);jQuery(".cabinet-avatar").attr("src",a.success)}}}}jQuery(function(){if(jQuery(".ajax-button").length>0){jQuery(".ajax-button").attr("type","button");jQuery("body").append('<form class="ajaxupload hidden" action="/cabinet/upload" method="post" enctype="multipart/form-data"><label for="selectfile"><input type="file" name="selectfile" id="selectfile"></label></form>');jQuery(document.body).on("click",".ajax-button",function(a){a.preventDefault();jQuery(".ajaxupload label").click()})}jQuery(document.body).on("change","#selectfile",function(a){jQuery(".ajaxupload").submit()});jQuery(document.body).on("submit",".ajaxupload",function(f){errors=false;filename=jQuery("#selectfile").val();if(filename.substring(3,11)=="fakepath"){filename=filename.substring(12)}if(filename==""){errors=true;jQuery("#response").removeClass().addClass("upload-error").html("Файл не выбран")}if(!errors){var h=0;console.log("filename "+filename);var g=new XMLHttpRequest();if(g.upload){g.upload.onprogress=function(j){var e=j.position||j.loaded;var i=j.totalSize||j.total;percent=(Math.floor(e/i*1000)/10)+"%";h=e;console.log(percent)}}g.onreadystatechange=function(i){if(4==this.readyState){xhr_complete(this)}};var a=jQuery("#selectfile");var c=a[0].files[0];var b=a.closest("form").prop("action");g.open("POST",b);g.setRequestHeader("X-Requested-With","XMLHttpRequest");var d=new FormData();d.append("file",c);g.send(d);f.preventDefault()}return false})});